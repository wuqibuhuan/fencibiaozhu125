<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>标注管理</title>
  <link href="./static/css/bootstrap.min.css" rel="stylesheet">
  <link href="./static/css/commen.css" rel="stylesheet">
  <link href="./static/css/report list.css" rel="stylesheet">
  <link href="./static/css/support.css" rel="stylesheet" type="text/css">
  <!-- <link href="http://cdn.jsdelivr.net/webjars/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet"
        media="screen" /> -->
  <link rel="stylesheet" href="./static/css/styles.css">
  <link rel="stylesheet" href="./static/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="./static/css/herder.css">
  <link rel="stylesheet" href="./static/css/li.css">
  <link rel="stylesheet" href="./static/css/zi.css">
  <link rel="stylesheet" type="text/css" href="./static/css/default.css" />


  <style>
    .cor {
      color: #0daaed;
    }

    .layui-laypage-limits {
      display: none !important;
    }

    .jing {
      color: #0daaed;
    }
  </style>
</head>

<body>
  <!doctype html>
  <html>
  <div id="particles-js">
    <!-- <canvas width="100" height="100" style="width:100%;height:100%;"></canvas> -->
  </div>
  <script src="./static/js/herder.js"></script>

  <div class="container">

    <div class="clearfix"></div>
    <div class="box">
      <div class="title">
        <h3>标注管理</h3>
        <div>
          <div class="investment_f">
            <div class="investment_title">
              <div class="on">关系标注</div>
              <div class="two">属性标注</div>
              <!-- <div class="tree">去重结果</div>    -->
              <!-- <div class="frou">相似比对</div> -->
              <!-- <div class="clearfix"></div> -->
            </div>
            <div class="investment_con">
              <!-- 文档内容 -->
              <div class="investment_con_list">

                <div class="top_select">
                  <div class="left">

                    <input type="hidden" id="userId" value="29" />
                    <input type="hidden" id="time" />
                  </div>
                </div>
                <div class="list">
                  <button style="width: 80px; border: 0; color: black; border-radius: 5px;"
                    onclick="guanxi_dao()">导出</button>
                  <table class="table-striped table-bordered table-hover" id="demo" lay-filter="demo">
                  </table>
                  <!-- <table id="demo" lay-filter="detail"></table> -->
                </div>
              </div>
              <!-- 属性 -->
              <div class="investment_con_list">
                <button style="width: 80px; border: 0; color: black; border-radius: 5px;"
                  onclick="shuxing_dao()">导出</button>
                <table class="table-striped table-bordered table-hover" id="table" lay-filter="table">
                </table>
              </div>


            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript" src="./static/js/jquery-1.11.3.min.js" charset="UTF-8"></script>
  <script type="text/javascript" src="./static/js/3.3.2bootstrap.min.js"></script>
  <script src="./static/js/particles.js"></script>
  <script src="./static/js/app.js"></script>
  <script src="./static/js/particles.min.js"></script>
  <script src="./static/js/basepath.js"></script>
  <script src="./static/layui/layui.js"></script>
  <script src="./static/js/style.js"></script>

  <script type="text/html" id="barDemo">
    <!-- <a class="layui-btn layui-btn-xs" lay-event="detail">
      <p>查看</p>
    </a>
    <a class="layui-btn layui-btn-xs" lay-event="del">
      <p>删除</p>
    </a> -->
  <!-- <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" ><p>删除文件</p></a> -->
  </script>

  <!-- <script type="text/html" id="titleTpl">
  {{#  if(d.count ==""){ }}
    <a href="/detail/{{d.id}}" class="layui-table-link">{{d.title}}</a>
  {{#  } else { }}
    {{d.title}}(普通用户)
  {{#  } }}
</script> -->

  <script>
    $("herder li a").each(function () {
      if ($(this)[0].href == String(window.location)) {
        $(this).addClass("on").siblings().removeClass("on");
      }
    });
    $(function () {
      loadList();
      guanxi();
      // shijian();
      // xiangsi();
    });
    // 关系导出
    function guanxi_dao() {
      var type = "关系"
      // window.open(basePath + "/Mark/markExportExcel?type=" + type)
      window.location.href = basePath + "/Mark/markExportExcel?type=" + type

    }
    // 属性导出
    function shuxing_dao() {
      var type = "属性"
      // window.open(basePath + "/Mark/markExportExcel?type=" + type)
      window.location.href = basePath + "/Mark/markExportExcel?type=" + type

    }

    function getQueryString(name) {
      var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
      var r = window.location.search.substr(1).match(reg);
      if (r != null) {
        return unescape(r[2]);
      }
      return null;
    }

    // window.setInterval("freshList()",7000);
    // 文档列表
    function loadList() {

      //获取查询时间与查询内容
      var userId = $("#userId").val();
      var createDate = $("#time").val();
      var status = $("#selectType option:selected").val();
      var documentName = $("#name").val();
      layui.use(['table', 'layer', 'laydate', 'laypage', 'util'], function () {
        var $ = layui.$,
          table = layui.table,
          layer = layui.layer,
          laydate = layui.laydate;
        var laypage = layui.laypage;
        var util = layui.util;
        //自定义格式
        laydate.render({
          elem: '#demo',
          format: 'yyyy/MM/dd',
          range: true,
          theme: '#ff7f4f',
          done: function (value, date, endDate) {
            $("#time").val(value);
          }
        });



        table.render({
          elem: '#demo',
          page: {
            theme: '#ff7f4f',
          },

          page: true,
          // limits: [5, 10, 15], //显示
          // limit: 10 //每页默认显示的数量
          where: {
            // userId:userId,
            // createDate: createDate,
            // status: status,
            // likeName: documentName,
            type: "关系"
          } //如果无需传递额外参数，可不加该参数
          ,
          url: basePath + '/Mark/markManagement',
          cols: [
            [
              // { type: 'checkbox', width: 100, fixed: 'left', align: 'center' }
              , {
                title: '序号',
                align: 'center',
                type: 'numbers',
                // sort: true,
                width: 80
              }, {
                field: 'subject',
                title: '实体',
                width: 250,
                align: 'center'
              }, {
                field: 'predicate',
                width: 100,
                title: '关系',
                align: 'center',
                template: '#titleTpl'
              },
              {
                field: 'object',
                width: 250,
                title: '实体',
                align: 'center',
                // template: '#titleTpl'
              },
              // {
              //   field: 'userName',
              //   width: 200,
              //   title: '上传用户',
              //   align: 'center',
              //   template: '#titleTpl'
              // },
              // {
              //   field: 'uploadTime',
              //   width: 200,
              //   title: '上传时间',
              //   align: 'center'
              // }
              {
                field: 'source',
                // width: 130,
                title: '来源',
                align: 'center',
                // template: '#titleTpl'
              },
              // , { field: 'status', width: 213, title: '状态', align: 'center' }
              // , { field: 'uploadDate', width: 170, title: '上传时间', align: 'center' }
              // , { width: 283, title: '操作', align: 'center', toolbar: "#barDemo" }

            ]
          ],
          done: function (res, curr, count) {
            // $('th').css({
            //   'background-color': '#ed6a1a',
            //   'color': '#fff',
            //   'font-weight': 'bold'
            // })
          },
          parseData: function (res) { //res 即为原始返回的数据
            //    console.log(res.data.pageList[name])

            return {
              "code": res.status, //解析接口状态
              "msg": res.message, //解析提示文本
              "count": res.totalCount, //解析数据长度
              "data": res.list //解析数据列表
            };
          },
          request: {
            pageName: 'pageNo' //页码的参数名称，默认：page
              ,
            limitName: 'pageSize' //每页数据量的参数名，默认：limit
          }

        });



        //监听表格复选框选择
        table.on('checkbox(demo)', function (obj) {
          console.log(obj);
        });

        //监听工具条
        table.on('tool(demo)', function (obj) {
          var data = obj.data;
          console.log(obj)
          if (obj.event === 'detail') {
            if (data.status == '解析失败') {
              layer.msg('此文件解析失败，无法查看明细', {
                time: 1800,
                icon: 2
              });
            } else {
              var time = getQueryString(name = "time")
              var uuid = obj.data.uuid
              var url = "./fllow.html?time=" + time + "&uuid=" + uuid;
              window.location.href = url;
            }

          } else if (obj.event === 'del') {
            layer.confirm('确认删除？', {
              btn: ['确定', '取消'],
              btn1: function (index, layero) {
                //后台执行删除操作
                $.post(basePath + '/eye/delete', {
                  'docId': data.id
                }, function (data) {
                  if (data.status == 1) {
                    layer.msg("删除成功", {
                      time: 1800,
                      icon: 1
                    });
                    loadList();
                  } else {
                    layer.msg('删除失败', {
                      time: 1800,
                      icon: 2
                    });
                  }
                }, 'json');
                layer.close(index);
              },
              btn2: function (index, layero) {
                layer.close(index);
              }
            });
          } else if (obj.event === 'edit') {
            var uuid = obj.data.uuid
            window.open(basePath + "/file/download?uuid=" + uuid)
            // var url = "./fllow.html?time=" + time + "&uuid=" + uuid;
            // window.location.href = url;
            // if (data.status == '已修改' || (data.status == '核查完成' && data.errorCount == '0')) {
            //     $.post('', {
            //         'docId': data.id
            //     }, function (data, status) {
            //         if (data == 'false') {
            //             layer.msg('下载失败', {
            //                 time: 1800,
            //                 icon: 2
            //             });
            //         } else {
            //             data = JSON.parse(data);

            //             window.location.href = basePath + "/eye/down-file/" + data.downkey +
            //                 "/" + data.docId;
            //         }
            //     });
            // } else {
            //     layer.msg('此文件不可以下载', {
            //         time: 1800,
            //         icon: 2
            //     });
            // }
          }
        });

      });
    };

    function batchDel() {
      /* <![CDATA[*/
      layui.use(['layer', 'table'], function () {
        var table = layui.table,
          layer = layui.layer,
          $ = layui.$
        var checkStatus = table.checkStatus('demo'),
          data = checkStatus.data;
        if (data == '') {
          layer.msg('请选择要删除的文件', {
            time: 1800,
            icon: 1
          });
        } else {
          layer.confirm('真的要删除么', {
            btn: ['确定', '取消'],
            btn1: function (index, layero) {
              var json = '';
              for (var i = 0; i < data.length; i++) {
                json += data[i].id + '-';
              }
              $.post(basePath + '/eye/batch-delete', json, function (data) {
                var data = eval('(' + data + ')');
                if (data.status == 1) {
                  layer.msg(data.msg, {
                    time: 1800,
                    icon: 1
                  });
                  loadList();
                } else {
                  layer.msg(data.msg, {
                    time: 1800,
                    icon: 2
                  });
                }
              }, 'text');
              layer.close(index);
            },
            btn2: function (index, layero) {
              layer.close(index);
            }
          });
        };

        /*]]>*/
      });
    }

    function freshList() {
      $.post(basePath + '/eye/fresh', function (data) {
        var data = eval('(' + data + ')');
        if (data.status == 1) {
          loadList();
        }
      });
    }
    //  属性
    function guanxi() {
      layui.use(['table', 'layer', 'laydate', 'jquery'], function () {
        var $ = layui.jquery,
          table = layui.table,
          layer = layui.layer,
          laydate = layui.laydate;
        var createDate = $("#time3").val();
        var search = $("#search").val();
        var time = getQueryString(name = "time")
        console.log(time)
        //自定义格式

        //属性列表显示
        table.render({
          elem: '#table',
          //width: 1400,
          // height: 280,
          page: true,
          where: {
            type: "属性"
          }, //如果无需传递额外参数，可不加该参数
          // limit: 10,
          // limits: [5, 10, 15],
          sort: true,
          url: basePath + '/Mark/markManagement',
          method: 'GET',

          parseData: function (res) {
            // console.log(res)
            return {
              "code": res.status, //解析接口状态
              "msg": res.message, //解析提示文本
              "count": res.totalCount, //解析数据长度
              "data": res.list //解析数据列表
            };
          },
          request: {
            pageName: 'pageNo' //页码的参数名称，默认：page
              ,
            limitName: 'pageSize' //每页数据量的参数名，默认：limit

          },
          cols: [
            [
              // { type: 'checkbox', width: 100, fixed: 'left', align: 'center' }
              , {
                title: '序号',
                align: 'center',
                type: 'numbers',
                // sort: true,
                width: 80
              }, {
                field: 'subject',
                title: '实体',
                width: 250,
                align: 'center'
              }, {
                field: 'predicate',
                width: 100,
                title: '属性',
                align: 'center',
                template: '#titleTpl'
              },
              {
                field: 'object',
                width: 250,
                title: '属性值',
                align: 'center',
                // template: '#titleTpl'
              },
              // {
              //   field: 'userName',
              //   width: 200,
              //   title: '上传用户',
              //   align: 'center',
              //   template: '#titleTpl'
              // },
              // {
              //   field: 'uploadTime',
              //   width: 200,
              //   title: '上传时间',
              //   align: 'center'
              // }
              {
                field: 'source',
                // width: 130,
                title: '来源',
                align: 'center',
                // template: '#titleTpl'
              },
              // , { field: 'status', width: 213, title: '状态', align: 'center' }
              // , { field: 'uploadDate', width: 170, title: '上传时间', align: 'center' }
              // , { width: 283, title: '操作', align: 'center', toolbar: "#barDemo" }

            ]
          ],
          done: function (res, curr, count) {
            // $('th').css({
            //   'background-color': '#ed6a1a',
            //   'color': '#fff',
            //   'font-weight': 'bold'
            // })
          }
        });
        table.on('tool(tuwen)', function (obj) { //注：tool是工具条事件名，demo是table原始容器的属性 lay-filter="对应的值"
          var data = obj.data; //获得当前行数据
          // console.log(data)
          var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
          var tr = obj.tr; //获得当前行 tr 的DOM对象

          if (layEvent === 'imagedetail') { //查看
            // window.location.href =  '/imagedoc/start?id=' + data.id;
            window.open(basePath + '/imagedoc/start?id=' + encodeURI(data.id));

          } else if (layEvent === 'imagedel') { //删除
            layer.confirm('确定删除文件名为：' + data.docName + "的文件吗?", function (index) {

              // console.log(data.id);
              //向服务端发送删除指令
              $.ajax({
                url: '/image/delete-one ',
                type: 'post',
                dataType: 'json',
                data: {
                  'id': data.id
                }, //向服务端发送删除的id
                success: function (suc) {
                  if (suc == 200) {
                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                    layer.close(index);
                    // console.log(index);
                    layer.msg("删除成功", {
                      icon: 1
                    });
                  } else {
                    layer.msg("删除成功", {
                      icon: 1

                    });
                    table.reload('imageTables', {
                      where: { //设定异步数据接口的额外参数，任意设
                        'id': data.id
                      },
                      page: {
                        //  curr: 1 //重新从第 1 页开始
                        curr: $(".layui-laypage-em")
                          .next().html()
                      }
                    })

                  }
                }
              });
              layer.close(index);
            });
          }
        });

        $("#sc").click(function () {
          var checkStatus = table.checkStatus('imageTables');
          data = checkStatus.data;
          if (data.length == 0) {
            layer.msg("请选择要删除的选项！");
          } else {
            layer.confirm('确定批量删除文件吗?', function (index) {
              arr = new Array();;
              for (var i = 0; i < data.length; i++) {
                arr.push(data[i].id);
              }
              arr.join(",");
              console.log(arr);
              $.ajax({
                url: '/image/batchDelete ',
                type: 'post',
                dataType: 'json',
                data: {
                  'ids': arr.toString()
                }, //向服务端发送删除的id
                success: function (suc) {
                  layer.msg("删除成功", {
                    icon: 1
                  });
                  table.reload('imageTables', {
                    where: { //设定异步数据接口的额外参数，任意设
                      'id': 1
                    },
                    page: {
                      //  curr: 1 //重新从第 1 页开始
                      curr: $(".layui-laypage-em").next()
                        .html()
                    }
                  })


                }
              });
              layer.close(index);
            });
          }
        });


        $("#queding11").click(function () {
          var search2 = $("#search").val();
          table.reload('imageTables', {
            url: basePath + '/event/eventStatisticList',
            where: { //设定异步数据接口的额外参数，任意设
              // limitName: '10',
              // pageName: '1',
              // createDate: createDate,
              likeName: search2,
              time: time
            }
          });
          //    window.location.reload();
        });
      });
    }



    // 新词发现
    function shijian() {
      layui.use(['table', 'layer', 'laydate', 'jquery'], function () {
        var $ = layui.jquery,
          table = layui.table,
          layer = layui.layer,
          laydate = layui.laydate;
        var createDate = $("#time2").val();
        var search = $("#succ").val();
        //自定义格式
        laydate.render({
          elem: '#date2',
          format: 'yyyy/MM/dd',
          range: true,
          theme: '#ff7f4f',
          done: function (value, date, endDate) {
            $("#time2").val(value);
            table.reload('table', {
              url: basePath + '/newWord/nwList',
              where: { //设定异步数据接口的额外参数，任意设
                limitName: '10',
                pageName: '1',
                // userId:userId,
                createDate: value,
                likeName: search
              }
            });
          }
        });
        var tableIns = table.render({
          elem: '#table',
          page: true,
          // limit: 10,
          // limits: [5, 10, 15],
          sort: true,
          where: {
            // userId:userId,
            createDate: createDate,
            status: status,
            // likeName: documentName,
            time: time
          }, //如果无需传递额外参数，可不加该参数
          url: basePath + '/newWord/nwList',
          method: 'GET',
          request: {
            limitName: 'pageSize',
            pageName: 'pageNum',
            likeName: search
          }, //请求参数
          parseData: function (res) {
            // console.log(res)
            return {
              "code": 0,
              "msg": "",
              "count": res.data.totalCount,
              "data": res.data.pageList
            }
          },
          cols: [
            [
              // { type: 'checkbox', fixed: 'left' },
              {
                type: 'numbers',
                // field: 'id',
                title: '序号',
                align: 'center',

                // sort: true,
                width: 80
              },
              {
                field: 'fromDocName',
                title: '文档名称',
                align: 'center',
                width: 180
              },
              {
                field: 'name',
                title: '词汇名称',
                // templet: function (d) {
                //     return '<span>' + d.from + '</span>'
                // },

                align: 'center',
                width: 220
              },
              {
                field: 'createDate',
                title: '生成时间',
                align: 'center',
                width: 180
              },
              {
                field: 'infoe',
                title: '信息熵',
                width: 280,
                align: 'center',
                // toolbar: '#tables',

              },
              {
                field: 'feq',
                title: '词频',
                // width:,
                align: 'center',
                // toolbar: '#tables',

              },
              // {
              //     field: 'src',
              //     title: '操作',

              //     align: 'center',
              //     // toolbar: '#tables',

              // },
            ]
          ],
          done: function (res, curr, count) {
            $('th').css({
              'background-color': '#ed6a1a',
              'color': '#fff',
              'font-weight': 'bold'
            })
          }
        });

        $("#queding12").click(function () {
          var search2 = $("#succ").val();
          table.reload('table', {
            url: basePath + '/extract/relations',
            where: { //设定异步数据接口的额外参数，任意设
              // limitName: '10',
              // pageName: '1',
              // createDate: createDate,
              likeName: search2
            }
          });
          //    window.location.reload();
        });
        table.on('tool(fanwen)', function (obj) { //注：tool是工具条事件名，demo是table原始容器的属性 lay-filter="对应的值"
          var data = obj.data; //获得当前行数据
          // console.log(data)
          var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
          var tr = obj.tr; //获得当前行 tr 的DOM对象
          if (layEvent === 'detail') { //查看
            //do somehing
            // layer.alert('序号:' + data.userId + '<br>id:' + data.jobNo + '<br>编号：' + data.userName + '<br>密码:' + data.pwd + '<br>权限:' + data.class);
            // window.location.href =  '/contract/start?id=' + data.id;
            window.open(basePath + '/contract/start?id=' + encodeURI(data.id));

          } else if (layEvent === 'del') { //删除
            layer.confirm('确定删除文件名为：' + data.contractName + "的文件吗?", function (index) {

              // console.log(data.id);
              //向服务端发送删除指令
              $.ajax({
                url: '/contract/delete-contract ',
                type: 'post',
                dataType: 'json',
                data: {
                  'id': data.id
                }, //向服务端发送删除的id
                success: function (suc) {
                  if (suc == 200) {
                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                    layer.close(index);
                    // console.log(index);
                    layer.msg("删除成功", {
                      icon: 1
                    });
                  } else {
                    layer.msg("删除成功", {
                      icon: 1
                    });
                    table.reload('table', {
                      where: { //设定异步数据接口的额外参数，任意设
                        'id': data.id
                      },
                      page: {
                        //  curr: 1 //重新从第 1 页开始
                        curr: $(".layui-laypage-em")
                          .next().html()

                      }
                    })

                  }
                }
              });
              layer.close(index);
            });
          }
        });

        $("#piliang").click(function () {
          var checkStatus = table.checkStatus('table');
          data = checkStatus.data;
          if (data.length == 0) {
            layer.msg("请选择要删除的选项！");
          } else {
            layer.confirm('确定批量删除文件吗?', function (index) {
              arr = new Array();;
              for (var i = 0; i < data.length; i++) {
                arr.push(data[i].id);
              }
              arr.join(",");
              console.log(arr);
              $.ajax({
                url: '/contract/batchDelete ',
                type: 'post',
                dataType: 'json',
                data: {
                  'ids': arr.toString()
                }, //向服务端发送删除的id
                success: function (suc) {
                  layer.msg("删除成功", {
                    icon: 1
                  });
                  table.reload('table', {
                    where: { //设定异步数据接口的额外参数，任意设
                      'id': 1
                    },
                    page: {
                      //  curr: 1 //重新从第 1 页开始
                      curr: $(".layui-laypage-em").next()
                        .html()
                    }
                  })


                }
              });
              layer.close(index);
            });
          }
        });



      });

    }
    //   时间轴
    function createTime(v) {
      var date = new Date(v);
      var y = date.getFullYear();
      var m = date.getMonth() + 1;
      m = m < 10 ? '0' + m : m;
      var d = date.getDate();
      d = d < 10 ? ("0" + d) : d;
      var h = date.getHours();
      h = h < 10 ? ("0" + h) : h;
      var M = date.getMinutes();
      M = M < 10 ? ("0" + M) : M;
      var str = y + "-" + m + "-" + d + " " + h + ":" + M;
      return str;

    }
  </script>


</body>

</html>