<!DOCTYPE HTML>
<html>

<head>
  <title>KGB-knowledge</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="./static/css/style.css" type="text/css">
  <link rel="stylesheet" href="./static/css/li.css">
  <link rel="stylesheet" href="./static/css/zi-1.css">

  <link rel="stylesheet" href="./static/css/index.css">
  <link rel="stylesheet" href="./static/css/support.css">
  <link rel="stylesheet" href="./static/css/ui.css">
  <link rel="stylesheet" href="./static/css/ui.progress-bar.css">
  <link rel="stylesheet" href="./static/css/commen.css">
  <link rel="stylesheet" href="./static/layui/css/layui.css">
  <link rel="stylesheet" href="./static/css/herder.css">

  <style>
    .shou {
      border-bottom: 2px solid #0daaed;
    }

    .zi {
      color: #0daaed;
    }
  </style>
</head>

<body>

  <div id="particles-js"></div>
  <script src="./static/js/herder.js"></script>

  <div id="paged">





    <div id="content-1">

      <div class="box">
        <div class="yincang" style="width: 100%; height:100%">
          <img src="./static/img/shijue.png"
            style="display: block; width: 280px; margin:0px auto 20px auto; padding-top:50px;">
          <!--<h3>智能核查</h3>-->
          <!--<form action="" id="edite_id">-->
          <div class="layui-upload-drag" id="common">
            <i class="layui-icon" style="color: #33e;"></i>
            <p id="commonName">点击上传，或将文件拖拽到此处</p>



          </div>
          <!-- <input type="hidden" id="path" name="path" /> -->
          <div class="iv">
            <button id="but" class="but"></button>
            <p></p>
          </div>



        </div>

        <div class="list-1">
          <div class="models">
            <div class="tuwen">
              <img src="./static/img/zairu.png" alt="">
              <div id="progress_bar-1" class="ui-progress-bar-1 ui-container-1">
                <div class="ui-progress-1" style="width:5%">
                  <span class="ui-label" style="display:none; color: #fff">正在加载...
                    <b class="value">79%</b>
                  </span>
                </div>
              </div>
              <!-- /Progress bar -->
              <div class="content" id="main_content-1" style="display: none;">
                <p id="deng">已生成，请前往查看</p>
              </div>
              <button class="start-1 ding-1 ">返回</button>

              <button class="start-11 wei" id="view">
                <a>查看结果</a>
              </button>
            </div>
          </div>
        </div>
      </div>



      <!-- <button class="but">提交</button> -->
      <div class="list">

        <h3 style="margin-top: 10px;">上传列表展示区</h3>

        <table class="table-striped table-bordered table-hover tdd" id="con">
          <thead>
            <tr>
              <th>文件名</th>
              <th>大小</th>
              <th>状态</th>
              <th>操作</th>
            </tr>
          </thead>
        </table>

        <input type="hidden" id="path" name="path" />
      </div>
    </div>
    <!-- <img src="./img/shurukuang.png" alt=""> -->


    <div class="clearfix"></div>
  </div>
  <footer id="dibu">
    <p>©版权灵玖所有</p>
  </footer>

  <script src="./static/js/particles.min.js"></script>
  <script src="./static/js/particles.js"></script>
  <script src="./static/js/app.js"></script>
  <script type="text/javascript" src="./static/js/jquery-1.11.3.min.js" charset="UTF-8"></script>
  <script src="./static/js/basepath.js"></script>
  <script type="text/javascript" src="./static/js/3.3.2bootstrap.min.js"></script>
  <script src="./static/layui/layui.js"></script>
  <script src="./static/layui/layui.all.js"></script>
  <script src="./static/js/index.js"></script>
  <script src="./static/js/progressbar.js"></script>

  <script>
    // window.onresize=function() {
    // var docWidth=document.body.clientWidth;
    // var docHeight=document.body.clientHeight;
    // var el=document.getElementById("yemei-1");

    // el.style.width=docWidth * 0.5+'px';
    // el.style.height=docHeight * 0.5 +'px';
    // }


    // $('#but').click(function () {
    //     window.location.href = 'index.html';
    // })
    $("herder li a").each(function () {
      if ($(this)[0].href == String(window.location)) {
        $(this).addClass("on").siblings().removeClass("on");
      }
    });

    var imageContent;
    var hFlag = 0;
    var fanFlag = 0;
    var imageContent2;
    // $(function () {
    //     var doc = localStorage.getItem('docId');
    //     //        alert(doc);
    //     getDocumentList();
    //     //        freshPage()
    // });
    // window.setInterval("freshPage()", 3000);

    //    var sendmes = $("input[name='sendmes']:checked").val();
    layui.use(['form', 'upload', 'layer', 'table'], function () {

      var $ = layui.jquery,
        upload = layui.upload,
        form = layui.form,
        element = layui.element //Tab的切换功能，切换事件监听等，需要依赖element模块
        ,
        layer = layui.layer,
        table = layui.table;
      //            ,index = layer.load(1);



      //执行实例

      $.ajaxSetup({
        xhrFields: {
          withCredentials: true
        }
      });
      var time;
      $("#but").click(function () {
        if (!$('table').find('td:visible').length) {
          layer.msg("请先上传文件！");
        } else {
          $('.list-1').animate({
            left: 0
          }, 1000)
          $(".list-1").css("display", "block")
          $(".yincang").css("display", "none")
        }
      })

      //多文件列表示例
      var demoListView = $('#con'),
        uploadListIns = upload.render({
          elem: '#common',
          url: basePath + '/upload/uploadFile',
          accept: 'file',
          multiple: false,
          async: false,
          auto: false,
          bindAction: '#but',
          choose: function (obj) {
              var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
              //读取本地文件
              obj.preview(function (index, file, result) {
                var tr = $(['<tr id="upload-' + index + '">', '<td>' + file.name + '</td>', '<td>' + (file
                    .size / 1014).toFixed(1) + 'kb</td>', '<td>等待上传</td>', '<td>',
                  '<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>',
                  '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>',
                  '</td>', '</tr>'
                ].join(''));

                //单个重传
                tr.find('.demo-reload').on('click', function () {
                  obj.upload(index, file);
                });

                //删除
                tr.find('.demo-delete').on('click', function () {
                  delete files[index]; //删除对应的文件
                  tr.remove();
                  uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                });

                demoListView.append(tr);
              });
            }

            ,
          done: function (res, index) {

              time = res.data;

              console.log(res)
              if (res.status == 0) { //上传成功

                var tr = demoListView.find('tr#upload-' + index),
                  tds = tr.children();
                tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
                tds.eq(3).html(''); //清空操作
                // return delete this.files[index]; //删除文件队列已经上传成功的文件
                $('#progress_bar-1 .ui-progress-1 .ui-label').hide();
                $('#progress_bar-1 .ui-progress-1').css('width', '5%');
                var test1 = setInterval(function () {
                  $('#progress_bar-1 .ui-progress-1').animateProgress(31, function () {
                    if (res.status == 0) {
                      $(this).animateProgress(100, function () {
                        $('#main_content-1').slideDown();
                        $('#fork_me').fadeIn();
                        $('.wei').show();
                        // $("#hechaid").val(data.data.id);
                      });

                    }
                  });
                  window.clearTimeout(test1);
                }, 4000);
              }
              $("#view").click(function () {
                // var url = "./result.html?time=" + time;
                // window.location.href = url;
                window.open("./index.html")
              })

              // this.error(index, upload);
              // return time;

            }

            ,
          error: function (index, upload) {
            var tr = demoListView.find('tr#upload-' + index),
              tds = tr.children();
            tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
            tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传
          },
        });
    });
  </script>
</body>

</html>